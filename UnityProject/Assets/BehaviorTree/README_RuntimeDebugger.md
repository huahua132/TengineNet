# 行为树运行时调试窗口使用指南

## 📺 功能概述

运行时调试窗口是一个强大的工具，用于实时查看和调试运行中的行为树。它提供了三栏式界面，让你能够：

- 📋 **左侧面板**：查看所有正在运行的行为树列表
- 🌳 **中间面板**：可视化显示选中的行为树结构
- 📊 **右侧面板**：查看上下文数据和节点属性

## 🚀 快速开始

### 1. 打开调试窗口

在Unity编辑器菜单栏选择：
```
Tools > BehaviorTree > Runtime Debugger
```

### 2. 运行游戏

运行时追踪是**自动启用**的，当你调用 `InitFromAsset()` 初始化行为树时：

```csharp
// 创建并初始化行为树
var tree = new BehaviorTree.Tree();
tree.Init(transform);
tree.InitFromAsset(treeAsset);  // 自动启用运行时追踪

// 现在就可以在调试窗口中看到这棵树了
```

无需任何额外代码，所有初始化的行为树都会自动出现在调试窗口中！

## 🎮 界面操作

### 左侧面板 - 树列表

- **点击树名称**：选择并查看该行为树
- **自动刷新开关**：启用后每0.5秒自动刷新列表
- **刷新按钮**：手动刷新树列表

每个树条目显示：
- 树的名称（包含绑定的GameObject名称）
- 实例ID
- 运行次数（Tick计数）
- 最后执行结果
- 资产文件名

### 中间面板 - 树可视化

**视图操作**：
- **鼠标中键拖动**：平移画布
- **鼠标滚轮**：缩放视图（30%-200%）
- **居中按钮**：重置视图到初始位置

**节点显示**：
- **灰色节点**：普通状态
- **蓝色节点**：正在运行（RUNNING）
- **黄色节点**：当前选中
- **绿色节点**：成功完成（未来实现）
- **红色节点**：执行失败（未来实现）

**节点连接**：
- 父节点到子节点的连线显示树的结构关系

**点击节点**：
- 点击任意节点，右侧面板会显示该节点的详细属性

### 右侧面板 - 数据显示

#### 未选中节点时（显示上下文信息）

**基本信息**：
- 执行栈深度：当前挂起的节点数量
- 最后结果：上一次执行返回的结果
- 是否中断：树是否处于中断状态

**绑定对象**：
- 显示绑定的Transform和GameObject
- 显示GameObject的位置信息

**黑板数据**：
- 显示共享的黑板数据（待实现）

#### 选中节点时（显示节点属性）

**基本信息**：
- 节点ID
- 节点类型（类名）
- 是否挂起（IsResume状态）

**节点参数**：
- 显示节点的所有公共字段及其当前值
- 例如：WaitNode的time、mode等参数

**子节点**：
- 列出所有子节点
- 点击子节点按钮可快速跳转查看

## 💡 使用技巧

### 1. 调试运行中的树

启动游戏，打开Runtime Debugger窗口，即可实时看到：
- 哪个节点正在执行（蓝色高亮）
- 节点的参数值
- 执行栈状态

### 2. 多树调试

当有多个GameObject使用行为树时：
- 左侧列表会显示所有运行中的树
- 每个树的名称包含其绑定的GameObject名称
- 可以快速切换查看不同的树

### 3. 性能监控

通过观察：
- Tick Count（运行次数）：了解树的执行频率
- Last Result：查看树的执行状态
- 执行栈深度：判断是否有节点卡住

### 4. 参数调试

在右侧面板查看节点参数的实时值：
- WaitNode的等待时间
- LogNode的消息内容
- 自定义节点的配置参数

## 📝 代码示例

### 基础使用

```csharp
using UnityEngine;
using BehaviorTree;

public class MyAI : MonoBehaviour
{
    public BehaviorTreeAsset treeAsset;
    private Tree _tree;

    void Start()
    {
        // 创建树
        _tree = new Tree();
        _tree.Init(transform);
        _tree.InitFromAsset(treeAsset);  // 自动启用运行时追踪
    }

    void Update()
    {
        if (_tree != null)
        {
            _tree.TickRun();
        }
    }

    void OnDestroy()
    {
        // Clear会自动注销追踪
        _tree?.Clear();
    }
}
```

就这么简单！运行时追踪会自动工作，无需任何额外配置。

## 🔧 树的标识

每个行为树在调试窗口中的显示名称格式为：
```
[资产名称] ([GameObject名称])
```

例如：
- `EnemyAI (Enemy_001)`
- `BossPattern (Boss)`
- `PlayerBehavior (Player)`

这样可以轻松区分不同对象使用的行为树。

## ⚙️ 窗口设置

### 面板宽度调整

- 拖动左侧和右侧的分隔条可以调整面板宽度
- 最小宽度：150像素
- 调整后的宽度会保持到下次打开

### 自动刷新

- **启用**：每0.5秒自动刷新树列表和状态
- **禁用**：手动点击刷新按钮更新
- 建议在调试时启用，性能测试时禁用

## 🐛 常见问题

### Q1: 为什么看不到我的行为树？

**A:** 确保：
1. 游戏正在运行（Play Mode）
2. 树已成功初始化（`InitFromAsset` 返回true）
3. 点击"刷新"按钮或启用"自动刷新"

### Q2: 为什么节点不显示运行状态？

**A:** 
- 蓝色高亮只显示正在挂起（RUNNING）的节点
- 完成执行的节点会恢复正常颜色
- 确保树正在执行（调用TickRun）

### Q3: 如何查看黑板数据？

**A:**
黑板数据显示功能计划在未来版本实现。当前版本主要关注节点结构和执行状态。

### Q4: 窗口性能影响大吗？

**A:**
- 窗口本身只在打开且可见时才会刷新
- 追踪功能对运行时性能影响很小（每个树只记录基本信息）
- 调试窗口关闭时不影响游戏性能

### Q5: 可以同时追踪多少个树？

**A:**
理论上没有限制。系统会自动追踪所有初始化的行为树，并在树销毁时自动清理。

## 🎯 最佳实践

1. **开发阶段**：打开调试窗口实时监控行为树状态
2. **多树场景**：利用树名称快速定位目标对象
3. **节点调试**：点击节点查看详细参数和状态
4. **性能监控**：观察Tick Count了解执行频率
5. **及时清理**：组件销毁时调用 `Clear()` 自动注销追踪

## 📚 相关文档

- [`USAGE.md`](USAGE.md) - 行为树编辑器使用指南
- `BehaviorTreeTest.cs` - 测试组件示例代码
- `BehaviorTreeRuntimeManager.cs` - 运行时管理器源码
- `BehaviorTreeRuntimeDebugger.cs` - 调试窗口源码

## 🔄 版本历史

**版本 1.0** - 2026-01-14
- ✨ 初始版本
- ✅ 三栏式布局
- ✅ 实时树列表
- ✅ 树结构可视化
- ✅ 节点属性查看
- ✅ 上下文信息显示
- ✅ 自动刷新功能

## 🚧 未来计划

- [ ] 黑板数据可视化
- [ ] 节点执行历史记录
- [ ] 性能分析（每个节点的执行时间）
- [ ] 断点调试功能
- [ ] 节点执行路径高亮
- [ ] 导出调试数据
- [ ] 自定义视图配置

---

**享受调试！** 🎉